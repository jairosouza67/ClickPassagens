<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Firebase - ClickPassagens</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #357ae8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4285f4;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Teste de Configura√ß√£o Firebase</h1>
        
        <div id="config-status"></div>
        
        <div style="margin: 20px 0;">
            <button onclick="testEmailLogin()">Testar Login com Email</button>
            <button onclick="testGoogleLogin()">Testar Login com Google</button>
            <button onclick="checkCurrentUser()">Verificar Usu√°rio Atual</button>
            <button onclick="clearLogs()">Limpar Logs</button>
        </div>
        
        <div id="test-form" style="display:none; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 5px;">
            <h3>Login de Teste</h3>
            <input type="email" id="email" placeholder="Email" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
            <input type="password" id="password" placeholder="Senha" style="width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px;">
            <button onclick="doEmailLogin()">Fazer Login</button>
        </div>
        
        <h3>üìã Logs:</h3>
        <div id="logs" class="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            signInWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            onAuthStateChanged
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Configura√ß√£o do Firebase (mesma do .env)
        const firebaseConfig = {
            apiKey: "AIzaSyDAcLO47JOWxvEa-fpzDI02zd6C1ab6uGA",
            authDomain: "clickpassagens-dee10.firebaseapp.com",
            projectId: "clickpassagens-dee10",
            storageBucket: "clickpassagens-dee10.firebasestorage.app",
            messagingSenderId: "334285502963",
            appId: "1:334285502963:web:31fe2e939e4bf56aac3a86"
        };

        let app, auth, googleProvider;

        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.borderLeftColor = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#4285f4';
            entry.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logsDiv.appendChild(entry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(message);
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('config-status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        // Inicializar Firebase
        try {
            log('üîÑ Inicializando Firebase...', 'info');
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            googleProvider = new GoogleAuthProvider();
            
            log('‚úÖ Firebase inicializado com sucesso!', 'success');
            showStatus('‚úÖ Firebase configurado corretamente!', 'success');
            
            // Listener de autentica√ß√£o
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    log(`üë§ Usu√°rio logado: ${user.email}`, 'success');
                    log(`   - UID: ${user.uid}`, 'info');
                    log(`   - Display Name: ${user.displayName || 'N/A'}`, 'info');
                    log(`   - Email Verified: ${user.emailVerified}`, 'info');
                } else {
                    log('üö™ Nenhum usu√°rio logado', 'info');
                }
            });
            
        } catch (error) {
            log(`‚ùå ERRO ao inicializar Firebase: ${error.message}`, 'error');
            showStatus('‚ùå Erro na configura√ß√£o do Firebase! Verifique as credenciais.', 'error');
            console.error(error);
        }

        // Fun√ß√µes globais para os bot√µes
        window.testEmailLogin = function() {
            document.getElementById('test-form').style.display = 'block';
            log('üìù Formul√°rio de login exibido', 'info');
        };

        window.doEmailLogin = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                log('‚ö†Ô∏è Preencha email e senha!', 'error');
                return;
            }
            
            try {
                log(`üîÑ Tentando login com: ${email}`, 'info');
                const result = await signInWithEmailAndPassword(auth, email, password);
                log(`‚úÖ Login bem-sucedido! Usu√°rio: ${result.user.email}`, 'success');
            } catch (error) {
                log(`‚ùå ERRO no login: ${error.code} - ${error.message}`, 'error');
                
                // Mensagens amig√°veis
                if (error.code === 'auth/user-not-found') {
                    log('üí° Sugest√£o: Esta conta n√£o existe. Crie uma nova conta primeiro.', 'info');
                } else if (error.code === 'auth/wrong-password') {
                    log('üí° Sugest√£o: Senha incorreta. Tente novamente.', 'info');
                } else if (error.code === 'auth/invalid-email') {
                    log('üí° Sugest√£o: Email inv√°lido.', 'info');
                }
            }
        };

        window.testGoogleLogin = async function() {
            try {
                log('üîÑ Iniciando login com Google...', 'info');
                log('ü™ü Abrindo popup do Google...', 'info');
                
                const result = await signInWithPopup(auth, googleProvider);
                
                log(`‚úÖ Login com Google bem-sucedido!`, 'success');
                log(`   - Email: ${result.user.email}`, 'success');
                log(`   - Nome: ${result.user.displayName}`, 'success');
                log(`   - Foto: ${result.user.photoURL}`, 'info');
                
            } catch (error) {
                log(`‚ùå ERRO no login Google: ${error.code} - ${error.message}`, 'error');
                
                // Mensagens amig√°veis
                if (error.code === 'auth/popup-blocked') {
                    log('üí° Sugest√£o: O popup foi bloqueado! Permita popups para este site.', 'info');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    log('üí° Voc√™ fechou o popup. Tente novamente.', 'info');
                } else if (error.code === 'auth/unauthorized-domain') {
                    log('üí° ERRO CR√çTICO: Dom√≠nio n√£o autorizado no Firebase Console!', 'error');
                    log('   Configure em: Authentication > Settings > Authorized domains', 'info');
                }
            }
        };

        window.checkCurrentUser = function() {
            const user = auth.currentUser;
            if (user) {
                log('üë§ Usu√°rio atual:', 'info');
                log(`   - Email: ${user.email}`, 'info');
                log(`   - UID: ${user.uid}`, 'info');
                log(`   - Display Name: ${user.displayName || 'N/A'}`, 'info');
                log(`   - Email Verified: ${user.emailVerified}`, 'info');
            } else {
                log('üö™ Nenhum usu√°rio logado no momento', 'info');
            }
        };

        window.clearLogs = function() {
            document.getElementById('logs').innerHTML = '';
            log('üóëÔ∏è Logs limpos', 'info');
        };

        // Log inicial
        log('üöÄ P√°gina carregada. Pronto para testar!', 'success');
    </script>
</body>
</html>
